@[TOC](基于巴菲特理论的强化学习股票交易系统+分布式技术)
：）

要是我有大量资源的话直接给大家官网网址上市试试用。股票交易模型是完全有效的，并且被可视化了。用预训练智能体DDPG（经过与A2C、TD3对比分析）进行历史数据交易。首先交易结果如下。

下面是对“AAPL”的回溯测试分析结果与真实股票走势情况对比
| 策略    | 最终资产价值         | 年化回报率        |年化标准误差   |夏普比率     |
|:-----------:| -------------:|:-------------:|:-------------:|:-------------|
| DDPG| ¥1519558.89  | 21% |22% |95% |
| REAL| ¥1424369.21 | 18% |30% |59%|

![DDPG对于“AAPL”的回溯测试结果（初始资产值为￥1000000.00）](https://i-blog.csdnimg.cn/direct/2d32205f05c349e3bd2379b9b1f704b6.png)
上图是DDPG对于“AAPL”的回溯测试结果（初始资产值为￥1000000.00）。AAPL是苹果的股票，AAPL是非常难套利的。博主的思路就是如果能用AAPL套到利，其他的股票为什么不行。

蓝线为由DDPG操控的交易资产价值走势，灰色线为股票价格乘以初始资金（如1000000）后的股票资产价值走势。绿色圆圈为买入信号，红色三角形为卖出信号。回溯测试结果显示，将“AAPL”作为验证集数据的DDPG策略智能体在模拟环境中产生了正收益，并且对于截止日期为2025年4月10日的交易资产最终价值高于股票的资产最终价值。这说明智能体对于交易策略的正确性。
# 基于分布式技术的AI金融投顾系统研究与应用
## 1）摘要
随着互联网与人工智能时代的到来，金融信息爆炸与大数据技术的发展为金融领域人工智能技术应用的研究提供了巨大的发展机遇，互联网经济的发展转型在效能、技术标准和信息安全等方面有了新的要求。本文结合利用分布式技术与人工智能技术，提出了基于分布式技术的AI金融投资顾问系统。系统的数据采集模块采用分布式技术进行存储与处理，实现系统的可扩展性和高效性；系统的数据处理模块利用强化学习技术，结合行为金融学，实现在动态变化的金融市场中，深入剖析多元的复杂数据，从而获取最优金融决策，进而提供更为有效的金融投资顾问服务。
## 2）训练数据结构
![数据结构](https://i-blog.csdnimg.cn/direct/88d61824527c459fab538548c9074842.png)

## 3）基于巴菲特股市理论与行为金融学的奖励函数
获得奖励（Reward）是优化强化学习智能体策略的方式与目标。本文基于总资产增长和总体市场情绪指标变量设计智能体的奖励函数，旨在通过市场情绪趋势、持股量、持股人资产变化量、以及对当前市场情绪的评分，优化智能体的策略策略，使其在动态市场环境下提升策略与市场情绪的对抗化，实现收益最大化。奖励函数的核心公式如下：          
      ![核心公式](https://i-blog.csdnimg.cn/direct/c000b3d91fe342cc82feb30e03ec9824.png)
### a. 资产净增长     
 ![资产净增长](https://i-blog.csdnimg.cn/direct/35b296e28c7f4e07bdab0c4b5f9976f5.png)

用于计算当前总资产和初始总资产之间的差额，反映投资策略是否有效、资产增值情况。该项直接奖励资产增值，旨在鼓励投资者实现长期的财富增长。
### b. 总体市场情绪指标
在市场情绪的建模中，本系统采用加权平均法整合多维情绪信号，包括的倒数、新闻情绪评分、美国和中国消费者信心指数。在加权平均法取代简单的指标加总方法的情况下，情绪指标与市场表现的相关性（皮尔逊相关系数）从0.45提升至0.62，显著提高了信号的预测能力。这一改进为模型提供了更科学的策略依据。权重通过历史数据回归分析确定，具体公式为：

![总体市场情绪指标](https://i-blog.csdnimg.cn/direct/5d5214fd6b954832a79cc231de8c9efb.png)
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/be484046c1354bc19de7d162c8f7ded3.png)
本系统的市场情绪指标都被转为正向指标，即任意情绪指标的数值越大，该指标所体现的市场情绪越积极。因此，可通过上面的公式来体现相对的总体市场情绪指标。以下公式所有市场变量都由总体市场情绪指标体现，并且都具有相对性，$*\_market$恒大于0。           
![(12)](https://i-blog.csdnimg.cn/direct/05c6822c8a764857a91de37a77596849.png)

“贪婪与恐惧”：巴菲特曾说，“当别人贪婪时你要恐惧，当别人恐惧时你要贪婪”。这一观点强调，在市场过于乐观时（即贪婪时），应当谨慎，而在市场情绪过于悲观时（即恐惧时），则应当抓住机会。当$m$>0，表示总体市场情绪偏向乐观（投资者情绪较为乐积极）；当$m$<0，表示总体市场情绪低迷（投资者情绪普遍悲观）。行为金融学理论认为，市场并非总是理性的，情绪化的市场伯丁往往导致投资者做出非理性策略。
$m$表示市场情绪的变化程度，即当前市场情绪与前一个时间点的情绪变化。由上面这个公式的$m$所示，$current\_market$为当前的总体市场情绪指标，$previous\_market$为当前的前一天总体市场情绪指标。反映了投资者的市场暴露程度，也反映了用户的买入行为。基于行为金融学的理论，下面的公式的逻辑思路可以根据历史买入行为对奖励机制进行额外调控。       
         
![(巴菲特理论)](https://i-blog.csdnimg.cn/direct/283c9d7c1b284106b01bc2f43d57384a.png)
- 当$m$为正数时，即总体市场情绪指标上升，应当奖励历史买入行为，历史买入越多（越大）则额外奖励越多，反之则越少；
- 当$m$为负数时，即总体市场情绪指标下降，应当惩罚历史买入行为，历史买入越多（越大）则额外惩罚越多，反之则越少。

### c. 趋势性收益项          
![趋势性收益项](https://i-blog.csdnimg.cn/direct/35a13a7ac9f04512b17781e7aac3ad69.png)  
- $\alpha$：控制市场情绪对趋势收益的影响程度。 $\alpha$越大，市场情绪的波荡对奖励的影响越显著；
- 波动抑制系数$\gamma$：用于调整因市场波动导致的计算策略；
- 波动抑制因子$1-\gamma(|m|/max(market\_memory))$ ：设计此项的目的是防止总体市场情绪波动剧烈时，奖励函数因趋势项过度放大而导致盲目追随情绪。该因子将极端情绪状态下的奖励适当削弱，从而避免“追涨杀跌”行为，体现了对风险管理的重视，其中公式的分母永不为0；
- $market\_memory$：按交易日为记忆时间单位的总体市场情绪指标记忆窗口；
- $min(market\_memory),max(market\_memory)$：总体市场情绪指标最小值、最大值。

### d. 市场情绪调整项

![市场情绪调整项](https://i-blog.csdnimg.cn/direct/f1d0a9764cfa42519912422574991137.png)
- 归一化公式(最后那一坨)：该归一化处理将初始总体市场情绪指标置于历史情绪极值的背景下考察，其中公式的分母永不为0；
- $\beta$：市场情绪影响的权重，控制市场情绪对奖励的贡献程度；
- $market\_memory_0$：初始总体市场情绪指标值。

初始总体市场情绪指标与市场历史情绪极值的关系，是决定市场情绪调整项的关键因素。这种关系能够反映总体市场情绪的相对位置，从而为策略提供理性依据。
“市场情绪调整项”通过总体市场情绪指标的相对变化调整投资策略，尤其时在总体市场情绪处于极端时，智能体可以根据历史数据做出相对更为理性的策略。通过归一化公式，奖励函数能够根据市场情绪变化而变化。此项设计正是对“贪婪与恐惧”的量化体现：
- 初始总体市场情绪接近或为历史最低点，对智能体买入行为的奖励更多；
- 初始总体市场情绪远离历史最低点，对智能体买入行为的奖励更少。

总体市场情绪指标相对位置的反映：当市场情绪低迷时，说明市场处于恐慌或低迷状态，此时存在低估现象，智能体应当增加持仓，以便在市场反弹时获利。反之，当市场情绪较高时，说明市场过度乐观，可能存在金融泡沫，智能体应当减少持仓，避免风险暴露。但是，智能体对于持仓的减少应当相对于投资者的市场暴露程度，比如，当市场趋向低迷时，当前持仓量多则应当正向奖励。

## 4）无咫云智能投顾平台

[video(video-KMJXHq9w-1746929892890)(type-csdn)(url-https://live.csdn.net/v/embed/476978)(image-https://i-blog.csdnimg.cn/img_convert/f3df65abc7e628dc46874c9a2366049f.jpeg)(title-系统演示)]

![介绍页](https://i-blog.csdnimg.cn/direct/e3e29c8737c64a6bae0026bc85f74900.png#pic_center)
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/2911da7db5c94e929cf36586690f2698.png)
![技术实现](https://i-blog.csdnimg.cn/direct/1c8f1f3a15a44c269dc78757b876a86c.png)![开始探索](https://i-blog.csdnimg.cn/direct/ebe7b3faad494fffa6d97953976dd6b3.png)
![模块说明&用户评价](https://i-blog.csdnimg.cn/direct/7e969494aa834d21bfe4e254417cfe60.png)
![帮助](https://i-blog.csdnimg.cn/direct/a61919ad32804c21af64e554887f30e2.png)
![页尾](https://i-blog.csdnimg.cn/direct/f75a033c5be845ecb7c72c21046337ab.png)

用户点击开始探索会进入到探索模式的起始页，再点击起始页标题即可进入探索模式的服务界面。用户点击了起始页标题后，会正式进入探索界面。同时，页面起始高度会被重置，这使得用户上滑后不会再进入起始页。起始页的使用不仅能使得品牌效益被放大，也增加了互动感与现代感，可以大大提高用户对于品牌的认知，以及审美体验。服务界面的左上角为索引，主体部分包括“WIZY. 投资偏好”、下载金融报告以及服务相关介绍。“WIZY. 投资偏好”要求用户选择投资类型、风险偏好以及一个股票代码，并点击“开始分析”。

![探索模式起始页](https://i-blog.csdnimg.cn/direct/7a09639fdea249e68e5e65d7d9d45670.png)
![探索模式起始页](https://i-blog.csdnimg.cn/direct/3d1a2b24752345e8babf4fe629d496e9.png)
![WIZY. 投资偏好](https://i-blog.csdnimg.cn/direct/28160af53c964d34be59f6dfe2de6740.png)


### a. 持仓配置与交易频率分析
在构建多资产配置模型时，采用Markowitz (1952)提出的均值—方差理论进行最优智能体构建，同时结合Sharpe (1964)的资产定价模型，判断在不同市场动荡环境下采取不同的资产配置策略。
针对低风险投资者，则采用20%-30%的股票持仓资金占比搭配70%-80%的债券持仓资金占比，且要求股票交易频率高；中风险投资者则采用50/50的股票/债券持仓资金占比，且要求股票交易频率中等；高风险投资者则保持70%-80%的股票配置以追求高收益，要求股票交易频率低，且只有在极端波动时才临时增配债券。
### b. 偏好与股票匹配分析
智能体交易股票所产生的收益对于不同股票有不同的特征结果。本系统将智能体交易结果的特征进行分析，从而判断用户投资偏好与股票是否匹配，进而为用户提出建议。以下分析依据来自于预训练DDPG智能体对于某一股票进行交易的资产价值时间序列表。
- 针对投资类型与智能体交易结果特征的匹配：
	- a.最高收益所用时间评分均值大于50：匹配长期投资；
	- b.最高收益所用时间评分均值小于50：匹配短期投资。

![最高收益所用时间评分](https://i-blog.csdnimg.cn/direct/9e19f97d44e7436da7f2eec4c60f0d90.png)


- 针对风险偏好与智能体交易结果特征的匹配：
	- 在用户所选的风险偏好下，预训练DDPG智能体交易资产最终值最小则不匹配（0级）。
	- 在用户所选的风险偏好下，预训练DDPG智能体交易资产最终值中等则不完全匹配（1级）；
	- 在用户所选的风险偏好下，预训练DDPG智能体交易资产最终值最大则匹配（2级）；
### c. 实例	
- 投资类型：短期投资（短期投资/长期投资）。
- 风险偏好：中风险（低风险/中风险/高风险）。
- 选择金融工具：白云机场/大陆股。

![WIZY. 投资偏好](https://i-blog.csdnimg.cn/direct/557127646a374ba0b41c791ed19e9058.png)

用户点击“开始分析”后，本系统UI界面向Docker Container（接口：8888:8888）发出请求，利用预训练DDPG智能体获得资产价值时间序列表与交易行为时间序列表，并按照投顾服务所需指标整理后可得下表。

|级别    | 波动阈值	  | 最终资产价值   |最终交易行为/股  |最高收益所用时间评分/100 |
|:-----------:| -------------:|:-------------:|:-------------:|:-------------|
| 0| 40  | ¥609613.80 |0.0 |8 |
| 1| 20 | ¥649740.97 |200 |59%|
| 2| 5| ¥1784520.99	 |200 |59%|


待系统分析完毕并获得结果后，将在投资偏好选择框右侧展示交易结果与匹配分析，如下图所示。
首先，对于白云机场股票的交易，本预训练DDPG智能体体现出极强的抗风险能力，没有让资产价值随着股票价格的大幅度下跌而有巨大的损失，说明智能体的决策能力较为可靠。其次，对于实例风险偏好的分析判断之与股票为匹配，这是因为长期持有（波动阈值高）该股票的亏损会比短期持有（波动阈值低）该股票的亏损高，因此判断为适合低风险，即匹配级别为2级。

![智能体交易结果与匹配分析](https://i-blog.csdnimg.cn/direct/b104c9a83469491396e8def605e3e292.png)

## 总结
谢谢支持！
